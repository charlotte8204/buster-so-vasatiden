<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stockholms blodbad - Vasatiden</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#f1f5f9;--card:#fff;--text:#1e293b;--muted:#64748b;--accent:#2563eb;--success:#16a34a;--danger:#dc2626;--warning:#f59e0b;--sidebar-bg:#1e293b;--sidebar-text:#e2e8f0;--concept:#2563eb;--fact:#16a34a;--person:#dc2626;--funfact:#f59e0b;--radius:10px;--shadow:0 2px 12px rgba(0,0,0,.08)}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:18px;line-height:1.7;color:var(--text);background:var(--bg);display:flex;min-height:100vh}
.sidebar{width:220px;background:var(--sidebar-bg);color:var(--sidebar-text);padding:20px 0;flex-shrink:0;display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;overflow-y:auto}
.sidebar .logo{padding:0 16px 16px;font-weight:800;font-size:1.1em;border-bottom:1px solid #334155}.sidebar .logo a{color:var(--sidebar-text);text-decoration:none}
.sidebar nav{padding:12px 0;flex:1}
.sidebar .section-title{padding:8px 16px;font-size:.7em;text-transform:uppercase;letter-spacing:1px;color:#94a3b8;margin-top:8px}
.sidebar a{display:flex;align-items:center;gap:8px;padding:7px 16px;color:#cbd5e1;text-decoration:none;font-size:.85em;transition:background .15s}
.sidebar a:hover{background:#334155}.sidebar a.active{background:var(--accent);color:#fff;font-weight:600}.sidebar a.done .icon{color:var(--success)}
.sidebar .progress-box{padding:12px 16px;border-top:1px solid #334155;margin-top:auto}
.sidebar .progress-box .bar{height:6px;background:#334155;border-radius:3px;overflow:hidden;margin-top:6px}
.sidebar .progress-box .bar-fill{height:100%;background:var(--success);border-radius:3px;transition:width .3s}
.sidebar .progress-box span{font-size:.7em;color:#94a3b8}
.main{margin-left:220px;flex:1;display:flex;flex-direction:column;min-height:100vh}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 28px;background:var(--card);border-bottom:1px solid #e2e8f0}
.topbar .breadcrumb{font-size:.8em;color:var(--muted)}.topbar .breadcrumb a{color:var(--accent);text-decoration:none}
.topbar .points{font-weight:700;color:var(--warning);font-size:.95em}
.topbar .text-controls button{background:none;border:1px solid #e2e8f0;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:.8em;margin-left:4px}
.content-area{flex:1;display:flex}.content{flex:1;padding:28px 32px;max-width:680px}
.content h1{font-size:1.5em;font-weight:800;margin-bottom:4px;color:var(--sidebar-bg)}
.content .subtitle{font-size:.85em;color:var(--muted);margin-bottom:20px}
.content p{margin-bottom:14px}
.term{color:var(--concept);font-weight:700;cursor:help;border-bottom:2px dotted var(--concept);position:relative}
.term:hover::after{content:attr(data-def);position:absolute;bottom:100%;left:0;background:var(--sidebar-bg);color:#fff;padding:8px 12px;border-radius:6px;font-size:.8em;font-weight:400;width:240px;z-index:10;line-height:1.4}
.fact{color:var(--fact);font-weight:600}.person{color:var(--person);font-weight:600}.year{color:var(--danger);font-weight:700}

/* Sort question */
.question-box{background:var(--card);border:2px solid #e2e8f0;border-radius:var(--radius);padding:20px;margin:20px 0;box-shadow:var(--shadow)}
.question-box h3{font-size:.95em;margin-bottom:12px}
.badge{display:inline-block;font-size:.65em;padding:2px 8px;border-radius:4px;font-weight:700;margin-bottom:8px;text-transform:uppercase}
.badge-c{background:#dbeafe;color:var(--accent)}
.sort-area{display:flex;flex-direction:column;gap:6px}
.sort-item{display:flex;align-items:center;gap:10px;padding:10px 14px;background:#f8fafc;border:2px solid #e2e8f0;border-radius:8px;cursor:pointer;transition:all .15s;user-select:none}
.sort-item:hover{border-color:var(--accent);background:#f0f6ff}
.sort-item.selected{border-color:var(--accent);background:#dbeafe}
.sort-item.placed{border-color:var(--success);background:#dcfce7;cursor:default}
.sort-item.wrong-place{border-color:var(--danger);background:#fee2e2}
.sort-item .num{width:28px;height:28px;border-radius:50%;background:#e2e8f0;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8em;flex-shrink:0}
.sort-item.placed .num{background:var(--success);color:#fff}
.sort-instruction{font-size:.85em;color:var(--muted);margin-bottom:10px;font-style:italic}

.feedback{margin-top:12px;padding:12px 16px;border-radius:8px;font-size:.9em;display:none}
.feedback.show{display:block}
.feedback.correct{background:#dcfce7;color:#166534}
.feedback.wrong{background:#fee2e2;color:#991b1b}
.hint-btn{background:none;border:none;color:var(--accent);cursor:pointer;font-size:.8em;margin-top:8px;font-family:inherit;text-decoration:underline}
.hint-box{margin-top:8px;padding:8px 12px;background:#f0f6ff;border-radius:6px;font-size:.85em;display:none}.hint-box.show{display:block}
.nav-buttons{display:flex;justify-content:space-between;align-items:center;margin-top:24px;padding-top:16px;border-top:1px solid #e2e8f0}
.nav-btn{padding:10px 24px;border-radius:8px;font-size:.9em;font-weight:600;cursor:pointer;font-family:inherit;text-decoration:none;border:none;display:inline-flex;align-items:center;gap:6px}
.nav-btn.secondary{background:#f1f5f9;color:var(--text)}.nav-btn.secondary:hover{background:#e2e8f0}
.nav-btn.primary{background:var(--accent);color:#fff;box-shadow:0 2px 8px rgba(37,99,235,.25)}.nav-btn.primary:hover{background:#1d4ed8}
.nav-btn.locked{opacity:.35;cursor:not-allowed;pointer-events:none}
.celebration{display:none;text-align:center;padding:12px;margin-top:12px;background:linear-gradient(135deg,#dcfce7,#dbeafe);border-radius:var(--radius);font-weight:600}.celebration.show{display:block}
.right-panel{width:200px;padding:20px 14px;flex-shrink:0}
.tip-card{background:#fffacd;border-radius:5px;padding:18px 15px;box-shadow:3px 3px 10px rgba(0,0,0,0.1),0 0 0 1px rgba(0,0,0,0.05);transform:rotate(-2deg);position:relative;margin-bottom:20px;margin-top:12px}
.tip-card::before{content:"";position:absolute;top:-8px;left:50%;transform:translateX(-50%);width:40px;height:15px;background:rgba(200,180,140,0.6);border-radius:2px}
.tip-card h4{font-size:13px;font-weight:600;color:#7a6a4a;margin-bottom:10px;text-transform:none;letter-spacing:normal}
.tip-card p{font-size:12px;line-height:1.5;color:#6a5a3a}
.pause-btn{position:fixed;bottom:30px;right:30px;background:#c8f0d0;border:none;padding:15px 25px;border-radius:30px;font-family:inherit;font-size:15px;color:var(--text);cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.1);transition:all 0.2s ease;z-index:50}
.pause-btn:hover{transform:scale(1.05);background:#88c498}
.pause-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:100;align-items:center;justify-content:center}.pause-overlay.show{display:flex}
.pause-modal{background:var(--card);border-radius:16px;padding:36px;text-align:center;max-width:380px;box-shadow:0 20px 60px rgba(0,0,0,.2)}
.pause-modal h2{font-size:1.3em;margin-bottom:12px}.pause-modal p{font-size:.95em;color:var(--muted);margin-bottom:20px}
.pause-modal button{padding:12px 28px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-size:1em;cursor:pointer;font-family:inherit;font-weight:600}
@media(max-width:960px){.sidebar{width:180px}.main{margin-left:180px}.right-panel{width:170px}}
@media(max-width:768px){.sidebar{display:none}.main{margin-left:0}.right-panel{display:none}.content{padding:20px}}
</style>
</head>
<body>
<div class="sidebar">
  <div class="logo"><a href="index.html">Vasatiden</a></div>
  <nav>
    <div class="section-title">Del 1: Striden om Sverige</div>
    <a href="del1-01-kalmarunionen.html" id="nav-del1-01"><span class="icon">&#9675;</span> Kalmarunionen</a>
    <a href="del1-02-maktkampen.html" id="nav-del1-02"><span class="icon">&#9675;</span> Maktkampen</a>
    <a href="del1-03-kristina-gyllenstierna.html" id="nav-del1-03"><span class="icon">&#9675;</span> Kristina Gyllenstierna</a>
    <a href="del1-04-stockholms-blodbad.html" class="active" id="nav-del1-04"><span class="icon">&#9654;</span> Stockholms blodbad</a>
    <a href="del1-05-gustav-vasa-blir-kung.html" id="nav-del1-05"><span class="icon">&#9675;</span> Gustav Vasa blir kung</a>
    <a href="del1-quiz.html" id="nav-del1-quiz"><span class="icon">&#9675;</span> Quiz: Del 1</a>
  </nav>
  <div class="progress-box">
    <span>Del 1: <span id="progressText">0/6</span></span>
    <div class="bar"><div class="bar-fill" id="progressBar" style="width:0%"></div></div>
  </div>
</div>

<div class="main">
  <div class="topbar">
    <div class="breadcrumb"><a href="index.html">Vasatiden</a> &rsaquo; Del 1 &rsaquo; Stockholms blodbad</div>
    <div style="display:flex;align-items:center;gap:12px">
      <div class="text-controls"><button onclick="changeSize(-1)">A-</button><button onclick="changeSize(1)">A+</button></div>
      <div class="points" id="pointsDisplay">0 p</div>
    </div>
  </div>

  <div class="content-area">
    <div class="content" id="contentArea">
      <div class="subtitle">Del 1 &middot; Sida 4 av 5</div>
      <h1>Stockholms blodbad</h1>

      <p>
        <span class="person">Kristian II</span> hade lovat att alla skulle f칬rl친tnas.
        I <span class="year">november 1520</span> bj칬d han in till en stor fest p친 slottet i Stockholm.
        Alla trodde att det var fred. De 친t, drack och dansade.
      </p>

      <p>
        Men mitt under festen st칛ngdes portarna.
        <span class="person">츿rkebiskop Trolle</span> anklagade 칬ver 80 personer f칬r
        <span class="term" data-def="K칛tteri = att g친 emot kyrkans l칛ra. P친 1500-talet var det ett allvarligt brott som kunde straffas med d칬den.">k칛tteri</span>.
        P친 <span class="fact">Stortorget i Stockholm avr칛ttades biskopar, adelsm칛n och vanliga borgare</span>.
      </p>

      <p>
        Liken l친gs kvar p친 torget i flera dagar. Sedan br칛ndes de.
        <span class="fact">Sammanlagt d칬dades ungef칛r hundra m칛nniskor</span>.
        H칛ndelsen kallas <span class="term" data-def="Massavr칛ttningen i Stockholm i november 1520. Kristian II l칛t d칬da m친nga svenska adelsm칛n, biskopar och borgare.">Stockholms blodbad</span>.
      </p>

      <p>
        Kristian fick 칬knamnet <span class="person">Kristian Tyrann</span> &ndash;
        och hans brutala handlande fick precis <em>motsatt effekt</em> fr친n vad han t칛nkt.
        Ist칛llet f칬r lydnad skapade han <span class="fact">rasande motst친nd 칬ver hela Sverige</span>.
      </p>

      <!-- QUESTION: Sort in order -->
      <div class="question-box" id="questionBox">
        <span class="badge badge-c">Niv친 C</span>
        <h3>Klicka p친 h칛ndelserna i r칛tt ordning (1 = f칬rst, 6 = sist):</h3>
        <p class="sort-instruction">Klicka i den ordning sakerna h칛nde.</p>
        <div class="sort-area" id="sortArea">
          <div class="sort-item" onclick="pickItem(this,0)" data-correct="2"><span class="num" id="num0">&nbsp;</span><span>Stor fest p친 slottet i Stockholm</span></div>
          <div class="sort-item" onclick="pickItem(this,1)" data-correct="0"><span class="num" id="num1">&nbsp;</span><span>Kristian blir kung 칬ver Kalmarunionen</span></div>
          <div class="sort-item" onclick="pickItem(this,2)" data-correct="4"><span class="num" id="num2">&nbsp;</span><span>Avr칛ttningar p친 Stortorget</span></div>
          <div class="sort-item" onclick="pickItem(this,3)" data-correct="5"><span class="num" id="num3">&nbsp;</span><span>Kristian kallas Kristian Tyrann</span></div>
          <div class="sort-item" onclick="pickItem(this,4)" data-correct="1"><span class="num" id="num4">&nbsp;</span><span>Kristina Gyllenstierna f칬rsvarar Stockholm</span></div>
          <div class="sort-item" onclick="pickItem(this,5)" data-correct="3"><span class="num" id="num5">&nbsp;</span><span>Trolle anklagar folk f칬r k칛tteri</span></div>
        </div>
        <button class="hint-btn" onclick="showHint(0)">Ledtr친d</button>
        <div class="hint-box" id="hint0">B칬rja med vem som blev kung f칬rst. Sedan &ndash; vad h칛nde innan festen?</div>
        <div class="feedback correct" id="fbCorrect">Perfekt ordning! Du har koll p친 hur h칛ndelserna h칛ngde ihop.</div>
        <div class="feedback wrong" id="fbWrong">N칛stan! R칛tt ordning var: Kristian blir kung &rarr; Kristina f칬rsvarar Stockholm &rarr; Fest p친 slottet &rarr; Trolle anklagar &rarr; Avr칛ttningar &rarr; Kristian Tyrann</div>
      </div>

      <div class="celebration" id="celebration">Bra, Buster! +10 po칛ng</div>

      <div class="nav-buttons">
        <a href="del1-03-kristina-gyllenstierna.html" class="nav-btn secondary">&larr; Kristina Gyllenstierna</a>
        <a href="del1-05-gustav-vasa-blir-kung.html" class="nav-btn primary locked" id="nextBtn">N칛sta: Gustav Vasa blir kung &rarr;</a>
      </div>
    </div>

    <div class="right-panel">
      <div class="tip-card">
        <h4>游닇 Tips till Buster</h4>
        <p>Stockholms blodbad 칛r ett bra exempel p친 n칛r en plan sl친r helt fel. Kristian ville skr칛mma folk till lydnad &ndash; men resultatet blev uppror.</p>
      </div>
      <div class="tip-card">
        <h4>游꿛 F칛rgkodning</h4>
        <p><span style="color:var(--concept);font-weight:700">Bl친</span> = Viktiga begrepp<br>
        <span style="color:var(--fact);font-weight:700">Gr칬n</span> = Viktiga fakta<br>
        <span style="color:var(--person);font-weight:700">R칬d</span> = 칀rtal &amp; personer<br>
        <span style="color:var(--funfact);font-weight:700">Gul</span> = Kul fakta</p>
      </div>
    </div>
  </div>
</div>

<button class="pause-btn" onclick="showPause()">游븾 Jag beh칬ver en paus</button>
<div class="pause-overlay" id="pauseOverlay">
  <div class="pause-modal">
    <h2 id="pauseTitle">Pausdags!</h2>
    <p id="pauseMsg">Res dig upp!</p>
    <button onclick="closePause()">Jag 칛r redo igen!</button>
  </div>
</div>

<script>
const PREFIX='buster-vasatiden-';
const PAGE_ID='del1-04';
let currentPick=0; // Next number to assign (0-5)
let picks=[]; // Array of item indices in pick order
let answered=false;
let hintsUsed=0;
let startTime=Date.now();

function getPoints(){return parseInt(localStorage.getItem(PREFIX+'points')||'0')}
function addPoints(n){const p=getPoints()+n;localStorage.setItem(PREFIX+'points',p.toString());updatePointsDisplay();return p;}
function updatePointsDisplay(){document.getElementById('pointsDisplay').textContent=getPoints()+' p';}
function getProgress(){return JSON.parse(localStorage.getItem(PREFIX+'progress')||'{}')}
function markComplete(){const p=getProgress();p[PAGE_ID]=true;localStorage.setItem(PREFIX+'progress',JSON.stringify(p));updateNav();}
function saveStats(correct,pts){
  const stats=JSON.parse(localStorage.getItem(PREFIX+'pageStats')||'{}');
  stats[PAGE_ID]={time:Math.round((Date.now()-startTime)/1000),hints:hintsUsed,correct:correct,points:pts,timestamp:new Date().toISOString()};
  localStorage.setItem(PREFIX+'pageStats',JSON.stringify(stats));
}

function pickItem(el,idx){
  if(answered||el.classList.contains('placed'))return;
  el.classList.add('placed');
  document.getElementById('num'+idx).textContent=currentPick+1;
  picks.push(idx);
  currentPick++;

  if(currentPick===6){
    checkOrder();
  }
}

function checkOrder(){
  answered=true;
  // Correct order of items: 1(Kristian kung), 4(Kristina), 0(Fest), 5(Trolle), 2(Avr칛ttningar), 3(Tyrann)
  const correctOrder=[1,4,0,5,2,3];
  let allCorrect=true;
  const items=document.querySelectorAll('.sort-item');

  for(let i=0;i<6;i++){
    if(picks[i]!==correctOrder[i]){
      allCorrect=false;
      items[picks[i]].classList.add('wrong-place');
      items[picks[i]].classList.remove('placed');
    }
  }

  if(allCorrect){
    const pts=hintsUsed>0?5:10;
    addPoints(pts);
    document.getElementById('fbCorrect').classList.add('show');
    document.querySelector('.celebration').textContent='Perfekt ordning, Buster! +'+pts+' po칛ng';
    document.querySelector('.celebration').classList.add('show');
    saveStats(true,pts);
  } else {
    addPoints(5);
    document.getElementById('fbWrong').classList.add('show');
    document.querySelector('.celebration').textContent='Bra f칬rs칬k! +5 po칛ng';
    document.querySelector('.celebration').classList.add('show');
    // Show correct order
    correctOrder.forEach((itemIdx,i)=>{
      document.getElementById('num'+itemIdx).textContent=i+1;
      items[itemIdx].className='sort-item placed';
    });
    saveStats(false,5);
  }
  document.getElementById('nextBtn').classList.remove('locked');
  markComplete();
}

function showHint(n){hintsUsed++;document.getElementById('hint'+n).classList.add('show');}

function updateNav(){
  const progress=getProgress();const pages=['del1-01','del1-02','del1-03','del1-04','del1-05','del1-quiz'];let done=0;
  pages.forEach(p=>{const el=document.getElementById('nav-'+p);if(el&&progress[p]){el.classList.add('done');el.querySelector('.icon').innerHTML='&#10003;';done++;}});
  document.getElementById('progressText').textContent=done+'/'+pages.length;
  document.getElementById('progressBar').style.width=Math.round(done/pages.length*100)+'%';
}
function changeSize(d){const el=document.getElementById('contentArea');el.style.fontSize=(parseFloat(getComputedStyle(el).fontSize)+d*2)+'px';}
const pauseMsgs=[{t:'R칬r p친 dig!',m:'G칬r 10 armh칛vningar!'},{t:'Andas!',m:'St칛ng 칬gonen och andas lugnt i 30 sekunder.'},{t:'Kolla ut!',m:'Titta ut genom f칬nstret &ndash; vad ser du?'},{t:'Str칛cka!',m:'St칛ll dig upp och rulla p친 axlarna.'},{t:'Snabbfr친ga!',m:'Kan du n칛mna tre svenska sj칬ar? T칛nk 10 sekunder.'}];
function showPause(){const m=pauseMsgs[Math.floor(Math.random()*pauseMsgs.length)];document.getElementById('pauseTitle').textContent=m.t;document.getElementById('pauseMsg').textContent=m.m;document.getElementById('pauseOverlay').classList.add('show');}
function closePause(){document.getElementById('pauseOverlay').classList.remove('show')}

function checkPrevious(){
  const progress=getProgress();
  if(progress[PAGE_ID]){
    answered=true;
    const correctOrder=[1,4,0,5,2,3];
    const items=document.querySelectorAll('.sort-item');
    correctOrder.forEach((itemIdx,i)=>{
      document.getElementById('num'+itemIdx).textContent=i+1;
      items[itemIdx].classList.add('placed');
    });
    document.getElementById('nextBtn').classList.remove('locked');
    document.querySelector('.celebration').textContent='Du har redan klarat denna sida!';
    document.querySelector('.celebration').classList.add('show');
  }
}
updatePointsDisplay();updateNav();checkPrevious();
</script>
</body>
</html>
