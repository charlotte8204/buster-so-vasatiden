<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz: Del 2 - Vasatiden</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#f1f5f9;--card:#fff;--text:#1e293b;--muted:#64748b;--accent:#2563eb;--success:#16a34a;--danger:#dc2626;--warning:#f59e0b;--sidebar-bg:#1e293b;--sidebar-text:#e2e8f0;--radius:10px;--shadow:0 2px 12px rgba(0,0,0,.08)}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:18px;line-height:1.7;color:var(--text);background:var(--bg);display:flex;min-height:100vh}
.sidebar{width:220px;background:var(--sidebar-bg);color:var(--sidebar-text);padding:20px 0;flex-shrink:0;display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;overflow-y:auto}
.sidebar .logo{padding:0 16px 16px;font-weight:800;font-size:1.1em;border-bottom:1px solid #334155}.sidebar .logo a{color:var(--sidebar-text);text-decoration:none}
.sidebar nav{padding:12px 0;flex:1}
.sidebar .section-title{padding:8px 16px;font-size:.7em;text-transform:uppercase;letter-spacing:1px;color:#94a3b8;margin-top:8px}
.sidebar a{display:flex;align-items:center;gap:8px;padding:7px 16px;color:#cbd5e1;text-decoration:none;font-size:.85em;transition:background .15s}
.sidebar a:hover{background:#334155}.sidebar a.active{background:var(--accent);color:#fff;font-weight:600}.sidebar a.done .icon{color:var(--success)}
.sidebar .progress-box{padding:12px 16px;border-top:1px solid #334155;margin-top:auto}
.sidebar .progress-box .bar{height:6px;background:#334155;border-radius:3px;overflow:hidden;margin-top:6px}
.sidebar .progress-box .bar-fill{height:100%;background:var(--success);border-radius:3px;transition:width .3s}
.sidebar .progress-box span{font-size:.7em;color:#94a3b8}
.main{margin-left:220px;flex:1;display:flex;flex-direction:column;min-height:100vh}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 28px;background:var(--card);border-bottom:1px solid #e2e8f0}
.topbar .breadcrumb{font-size:.8em;color:var(--muted)}.topbar .breadcrumb a{color:var(--accent);text-decoration:none}
.topbar .points{font-weight:700;color:var(--warning);font-size:.95em}

.content{max-width:700px;margin:0 auto;padding:28px 32px}
.content h1{font-size:1.5em;font-weight:800;margin-bottom:4px;color:var(--sidebar-bg)}
.content .subtitle{font-size:.85em;color:var(--muted);margin-bottom:8px}

.quiz-info{background:#fef3c7;border:2px solid #fbbf24;border-radius:var(--radius);padding:14px 18px;margin-bottom:20px;font-size:.9em;color:#92400e}

/* Question stepper */
.q-progress{display:flex;gap:6px;margin-bottom:20px}
.q-dot{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85em;border:2px solid #e2e8f0;color:var(--muted);background:var(--card)}
.q-dot.active{border-color:var(--accent);color:var(--accent);background:#dbeafe}
.q-dot.correct{border-color:var(--success);color:#fff;background:var(--success)}
.q-dot.wrong{border-color:var(--danger);color:#fff;background:var(--danger)}
.q-dot.partial{border-color:var(--warning);color:#fff;background:var(--warning)}

/* Question cards */
.q-card{display:none;background:var(--card);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);margin-bottom:16px}
.q-card.active{display:block}
.q-card h3{font-size:1em;margin-bottom:14px;color:var(--sidebar-bg)}
.badge{display:inline-block;font-size:.65em;padding:2px 8px;border-radius:4px;font-weight:700;margin-bottom:8px;text-transform:uppercase}
.badge-e{background:#dcfce7;color:var(--success)}
.badge-c{background:#dbeafe;color:var(--accent)}
.badge-a{background:#fef3c7;color:#92400e}

.options{display:flex;flex-direction:column;gap:8px}
.option-btn{display:block;width:100%;text-align:left;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;background:var(--card);cursor:pointer;font-size:.9em;font-family:inherit;transition:border-color .15s,background .15s}
.option-btn:hover:not(:disabled){border-color:var(--accent);background:#f0f6ff}
.option-btn.correct{border-color:var(--success);background:#dcfce7}.option-btn.wrong{border-color:var(--danger);background:#fee2e2}.option-btn:disabled{cursor:default}

/* Fill in */
.fill-input{width:200px;padding:8px 12px;border:2px solid #e2e8f0;border-radius:6px;font-family:inherit;font-size:.9em}
.fill-input:focus{border-color:var(--accent);outline:none}
.fill-input.correct{border-color:var(--success);background:#dcfce7}
.fill-input.wrong{border-color:var(--danger);background:#fee2e2}
.fill-submit{padding:8px 16px;background:var(--accent);color:#fff;border:none;border-radius:6px;cursor:pointer;font-family:inherit;font-size:.85em;font-weight:600;margin-left:8px}

/* True/False */
.tf-group{margin-bottom:12px;padding:12px 16px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}
.tf-group p{font-size:.9em;margin-bottom:8px;font-weight:500}
.tf-btns{display:flex;gap:8px}
.tf-btn{padding:6px 16px;border:2px solid #e2e8f0;border-radius:6px;background:var(--card);cursor:pointer;font-family:inherit;font-size:.85em;font-weight:600}
.tf-btn:hover:not(:disabled){border-color:var(--accent);background:#f0f6ff}
.tf-btn.correct{border-color:var(--success);background:#dcfce7}
.tf-btn.wrong{border-color:var(--danger);background:#fee2e2}
.tf-btn:disabled{cursor:default}
.tf-explain{font-size:.8em;color:var(--muted);margin-top:6px;display:none}
.tf-explain.show{display:block}

/* Open answer */
.open-answer{width:100%;min-height:70px;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-family:inherit;font-size:.9em;resize:vertical;line-height:1.5}
.open-answer:focus{border-color:var(--accent);outline:none}
.word-count{font-size:.75em;color:var(--muted);margin-top:4px}
.submit-open{margin-top:10px;padding:10px 20px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-size:.9em;cursor:pointer;font-family:inherit;font-weight:600}
.submit-open:disabled{opacity:.4;cursor:not-allowed}
.compare-box{display:none;margin-top:14px;padding:16px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}
.compare-box.show{display:block}
.compare-box h4{font-size:.85em;margin-bottom:8px;color:var(--muted)}
.compare-box .model-answer{background:#f0fdf4;padding:10px;border-radius:6px;font-size:.9em;margin-top:8px}
.self-assess{margin-top:12px;display:flex;gap:8px}
.self-assess button{padding:8px 16px;border-radius:6px;border:2px solid #e2e8f0;background:var(--card);cursor:pointer;font-family:inherit;font-size:.85em;font-weight:600}
.self-assess .yes-btn:hover{border-color:var(--success);background:#dcfce7}

.feedback{margin-top:12px;padding:12px 16px;border-radius:8px;font-size:.9em;display:none}
.feedback.show{display:block}
.feedback.correct{background:#dcfce7;color:#166534}
.feedback.wrong{background:#fee2e2;color:#991b1b}

.hint-btn{background:none;border:none;color:var(--accent);cursor:pointer;font-size:.8em;margin-top:8px;font-family:inherit;text-decoration:underline}
.hint-box{margin-top:8px;padding:8px 12px;background:#f0f6ff;border-radius:6px;font-size:.85em;display:none}.hint-box.show{display:block}

.next-q-btn{margin-top:14px;padding:10px 20px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-size:.9em;cursor:pointer;font-family:inherit;font-weight:600;display:none}
.next-q-btn.show{display:inline-block}

/* Results */
.results{display:none;background:var(--card);border-radius:var(--radius);padding:28px;box-shadow:var(--shadow);text-align:center}
.results.show{display:block}
.results h2{font-size:1.4em;margin-bottom:16px}
.results .score{font-size:2.5em;font-weight:800;margin:12px 0}
.results .score.great{color:var(--success)}
.results .score.good{color:var(--accent)}
.results .score.ok{color:var(--warning)}
.results .detail{font-size:.9em;color:var(--muted);margin-bottom:20px}
.result-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:16px 0;text-align:left}
.result-item{padding:10px 14px;border-radius:8px;font-size:.85em}
.result-item.right{background:#dcfce7;color:#166534}
.result-item.wrong{background:#fee2e2;color:#991b1b}
.result-item.partial{background:#fef3c7;color:#92400e}

.nav-buttons{display:flex;justify-content:space-between;align-items:center;margin-top:24px;padding-top:16px;border-top:1px solid #e2e8f0}
.nav-btn{padding:10px 24px;border-radius:8px;font-size:.9em;font-weight:600;cursor:pointer;font-family:inherit;text-decoration:none;border:none;display:inline-flex;align-items:center;gap:6px}
.nav-btn.secondary{background:#f1f5f9;color:var(--text)}.nav-btn.secondary:hover{background:#e2e8f0}
.nav-btn.primary{background:var(--success);color:#fff}.nav-btn.primary:hover{background:#15803d}
.nav-btn.locked{opacity:.35;cursor:not-allowed;pointer-events:none}

@media(max-width:960px){.sidebar{width:180px}.main{margin-left:180px}}
@media(max-width:768px){.sidebar{display:none}.main{margin-left:0}.content{padding:20px}}
</style>
</head>
<body>
<div class="sidebar">
  <div class="logo"><a href="index.html">Vasatiden</a></div>
  <nav>
    <div class="section-title">Del 2: Livet p&aring; Vasatiden</div>
    <a href="del2-01-bondernas-liv.html" id="nav-del2-01"><span class="icon">&#9675;</span> B&ouml;ndernas liv</a>
    <a href="del2-02-barn-och-arbete.html" id="nav-del2-02"><span class="icon">&#9675;</span> Barn och arbete</a>
    <a href="del2-03-gruvorna.html" id="nav-del2-03"><span class="icon">&#9675;</span> Gruvorna</a>
    <a href="del2-04-fest-och-lek.html" id="nav-del2-04"><span class="icon">&#9675;</span> Fest och lek</a>
    <a href="del2-quiz.html" class="active" id="nav-del2-quiz"><span class="icon">&#9654;</span> Quiz: Del 2</a>
  </nav>
  <div class="progress-box">
    <span>Del 2: <span id="progressText">0/5</span></span>
    <div class="bar"><div class="bar-fill" id="progressBar" style="width:0%"></div></div>
  </div>
</div>

<div class="main">
  <div class="topbar">
    <div class="breadcrumb"><a href="index.html">Vasatiden</a> &rsaquo; Del 2 &rsaquo; Quiz</div>
    <div class="points" id="pointsDisplay">0 p</div>
  </div>

  <div class="content" id="contentArea">
    <h1>Quiz: Livet p&aring; Vasatiden</h1>
    <div class="subtitle">Svara utan att titta tillbaka p&aring; texterna!</div>

    <div class="quiz-info">
      Det h&auml;r &auml;r en quiz om allt du l&auml;rt dig i Del 2. Du har inte tillg&aring;ng till texten &ndash; det &auml;r din kunskap som g&auml;ller nu! 6 fr&aring;gor &ndash; blandade E, C och A-niv&aring;er. Lycka till, Buster!
    </div>

    <!-- Progress dots -->
    <div class="q-progress" id="qProgress">
      <div class="q-dot active" id="dot0">1</div>
      <div class="q-dot" id="dot1">2</div>
      <div class="q-dot" id="dot2">3</div>
      <div class="q-dot" id="dot3">4</div>
      <div class="q-dot" id="dot4">5</div>
      <div class="q-dot" id="dot5">6</div>
    </div>

    <!-- Q1: E-level (flerval) -->
    <div class="q-card active" id="q0">
      <span class="badge badge-e">Niv&aring; E</span>
      <h3>Vad kallas b&ouml;nderna som &auml;gde sin egen mark?</h3>
      <div class="options">
        <button class="option-btn" onclick="answerMC(0,0)">Dr&auml;ngar</button>
        <button class="option-btn" onclick="answerMC(0,1)">Sj&auml;lv&auml;gande b&ouml;nder</button>
        <button class="option-btn" onclick="answerMC(0,2)">Pigor</button>
      </div>
      <button class="hint-btn" onclick="showHint(0)">Ledtr&aring;d</button>
      <div class="hint-box" id="hint0">T&auml;nk p&aring; vad det betyder att &auml;ga sin mark sj&auml;lv...</div>
      <div class="feedback correct" id="fb0-correct">R&auml;tt! &Ouml;ver h&auml;lften av b&ouml;nderna &auml;gde sin egen mark.</div>
      <div class="feedback wrong" id="fb0-wrong">Det r&auml;tta svaret &auml;r sj&auml;lv&auml;gande b&ouml;nder.</div>
      <button class="next-q-btn" id="next0" onclick="nextQ(1)">N&auml;sta fr&aring;ga &rarr;</button>
    </div>

    <!-- Q2: C-level (flerval) -->
    <div class="q-card" id="q1">
      <span class="badge badge-c">Niv&aring; C</span>
      <h3>Varf&ouml;r var gruvorna viktiga f&ouml;r Gustav Vasa?</h3>
      <div class="options">
        <button class="option-btn" onclick="answerMC(1,0)">Han gillade att gr&auml;va</button>
        <button class="option-btn" onclick="answerMC(1,1)">Silver och koppar gav pengar till staten och kunde anv&auml;ndas till mynt och vapen</button>
        <button class="option-btn" onclick="answerMC(1,2)">Han ville g&ouml;mma sig d&auml;r</button>
      </div>
      <button class="hint-btn" onclick="showHint(1)">Ledtr&aring;d</button>
      <div class="hint-box" id="hint1">T&auml;nk p&aring; vad man kan g&ouml;ra med silver och koppar...</div>
      <div class="feedback correct" id="fb1-correct">Precis! Gruvorna var som en bank f&ouml;r kungen.</div>
      <div class="feedback wrong" id="fb1-wrong">Silver och koppar gav pengar till staten och kunde anv&auml;ndas till mynt och vapen.</div>
      <button class="next-q-btn" id="next1" onclick="nextQ(2)">N&auml;sta fr&aring;ga &rarr;</button>
    </div>

    <!-- Q3: E-level (fyll-i-lucka) -->
    <div class="q-card" id="q2">
      <span class="badge badge-e">Niv&aring; E</span>
      <h3>Fyll i: Flickor som arbetade hos annan familj kallades ___</h3>
      <div style="display:flex;align-items:center;margin-top:10px">
        <input class="fill-input" id="fill2" type="text" placeholder="Skriv h&auml;r...">
        <button class="fill-submit" onclick="answerFill(2)">Kolla</button>
      </div>
      <button class="hint-btn" onclick="showHint(2)">Ledtr&aring;d</button>
      <div class="hint-box" id="hint2">Det b&ouml;rjar p&aring; bokstaven P...</div>
      <div class="feedback correct" id="fb2-correct">R&auml;tt! Flickor som arbetade hos en annan familj kallades piga.</div>
      <div class="feedback wrong" id="fb2-wrong">Svaret &auml;r &quot;piga&quot;.</div>
      <button class="next-q-btn" id="next2" onclick="nextQ(3)">N&auml;sta fr&aring;ga &rarr;</button>
    </div>

    <!-- Q4: C-level (sant/falskt med f&ouml;rklaring) -->
    <div class="q-card" id="q3">
      <span class="badge badge-c">Niv&aring; C &ndash; Sant eller falskt</span>
      <h3>Bed&ouml;m om p&aring;st&aring;endena &auml;r sanna eller falska:</h3>

      <div class="tf-group" id="tf0">
        <p>&quot;Barn p&aring; 1500-talet hade samma r&auml;ttigheter som barn idag&quot;</p>
        <div class="tf-btns">
          <button class="tf-btn" onclick="answerTF(0,true)">Sant</button>
          <button class="tf-btn" onclick="answerTF(0,false)">Falskt</button>
        </div>
        <div class="tf-explain" id="tf0-explain"></div>
      </div>

      <div class="tf-group" id="tf1">
        <p>&quot;Gycklare var d&aring;tidens komiker&quot;</p>
        <div class="tf-btns">
          <button class="tf-btn" onclick="answerTF(1,true)">Sant</button>
          <button class="tf-btn" onclick="answerTF(1,false)">Falskt</button>
        </div>
        <div class="tf-explain" id="tf1-explain"></div>
      </div>

      <div class="tf-group" id="tf2">
        <p>&quot;Gustav Vasa uppmuntrade folk att festa mer&quot;</p>
        <div class="tf-btns">
          <button class="tf-btn" onclick="answerTF(2,true)">Sant</button>
          <button class="tf-btn" onclick="answerTF(2,false)">Falskt</button>
        </div>
        <div class="tf-explain" id="tf2-explain"></div>
      </div>

      <button class="hint-btn" onclick="showHint(3)">Ledtr&aring;d</button>
      <div class="hint-box" id="hint3">T&auml;nk p&aring; vad du l&auml;rt dig om barns r&auml;ttigheter, gycklare och Gustav Vasas inst&auml;llning till fest...</div>
      <div class="feedback correct" id="fb3-correct">Snyggt! Du fick alla r&auml;tt!</div>
      <div class="feedback wrong" id="fb3-wrong"></div>
      <button class="next-q-btn" id="next3" onclick="nextQ(4)">N&auml;sta fr&aring;ga &rarr;</button>
    </div>

    <!-- Q5: A-level (&ouml;ppen fr&aring;ga) -->
    <div class="q-card" id="q4">
      <span class="badge badge-a">Niv&aring; A &ndash; Utmaning (+20p)</span>
      <h3>Varf&ouml;r tror du att b&ouml;nderna var beredda att g&ouml;ra uppror mot kungen, trots att de riskerade h&aring;rda straff?</h3>
      <textarea class="open-answer" id="open4" placeholder="Skriv ditt resonemang..." oninput="updateWC4()"></textarea>
      <div class="word-count" id="wc4">0 ord (minst 15)</div>
      <button class="submit-open" id="submit4" onclick="submitOpen(4)" disabled>Visa facit</button>
      <button class="hint-btn" onclick="showHint(4)">Ledtr&aring;d</button>
      <div class="hint-box" id="hint4">T&auml;nk p&aring; vad som h&auml;nder n&auml;r m&auml;nniskor k&auml;nner att de inte har n&aring;got val...</div>
      <div class="compare-box" id="compare4">
        <h4>Exempelsvar:</h4>
        <div class="model-answer">B&ouml;nderna var vana vid att vara fria och best&auml;mma sj&auml;lva. N&auml;r kungen eller andra f&ouml;rs&ouml;kte ta deras r&auml;ttigheter eller pengar, k&auml;nde de att de inte hade n&aring;got val. De hade en stark tradition av motst&aring;nd.</div>
        <div class="self-assess" id="sa4">
          <button class="yes-btn" onclick="selfAssessQ4(true)">Jag fick med det viktiga</button>
          <button class="yes-btn" onclick="selfAssessQ4(false)" style="background:#fefce8">Jag missade en del</button>
        </div>
      </div>
      <button class="next-q-btn" id="next4" onclick="nextQ(5)">N&auml;sta fr&aring;ga &rarr;</button>
    </div>

    <!-- Q6: A-level (flerval) -->
    <div class="q-card" id="q5">
      <span class="badge badge-a">Niv&aring; A</span>
      <h3>Olaus Magnus skrev om troll i gruvorna. Vad s&auml;ger det oss om hur folk p&aring; 1500-talet f&ouml;rstod v&auml;rlden?</h3>
      <div class="options">
        <button class="option-btn" onclick="answerMC(5,0)">De var dumma</button>
        <button class="option-btn" onclick="answerMC(5,1)">De anv&auml;nde &ouml;vernaturliga f&ouml;rklaringar f&ouml;r saker de inte f&ouml;rstod vetenskapligt</button>
        <button class="option-btn" onclick="answerMC(5,2)">De lj&ouml;g medvetet</button>
      </div>
      <button class="hint-btn" onclick="showHint(5)">Ledtr&aring;d</button>
      <div class="hint-box" id="hint5">T&auml;nk p&aring; hur m&auml;nniskor f&ouml;rklarar saker de inte f&ouml;rst&aring;r. P&aring; 1500-talet fanns inte modern naturvetenskap...</div>
      <div class="feedback correct" id="fb5-correct">Bra resonemang! Folk p&aring; 1500-talet hade inte samma naturvetenskap som vi. Ber&auml;ttelser om troll var deras s&auml;tt att f&ouml;rst&aring; farliga saker.</div>
      <div class="feedback wrong" id="fb5-wrong">De anv&auml;nde &ouml;vernaturliga f&ouml;rklaringar f&ouml;r saker de inte f&ouml;rstod vetenskapligt.</div>
      <button class="next-q-btn" id="next5" onclick="showResults()">Se resultat &rarr;</button>
    </div>

    <!-- RESULTS -->
    <div class="results" id="resultsBox">
      <h2>Resultat: Del 2</h2>
      <div class="score" id="scoreText"></div>
      <div class="detail" id="scoreDetail"></div>
      <div id="encouragement" style="font-size:1em;margin-bottom:16px"></div>
      <div class="result-grid" id="resultGrid"></div>
      <div class="nav-buttons" style="border:none;padding-top:0">
        <a href="del2-04-fest-och-lek.html" class="nav-btn secondary">&larr; Fest och lek</a>
        <a href="index.html" class="nav-btn primary">Tillbaka till &ouml;versikten &rarr;</a>
      </div>
    </div>
  </div>
</div>

<script>
const PREFIX='buster-vasatiden-';
const PAGE_ID='del2-quiz';
let currentQ=0;
let qResults=[null,null,null,null,null,null];
let qPoints=[0,0,0,0,0,0];
let hintsUsed=[0,0,0,0,0,0];
let totalQuizPoints=0;
let startTime=Date.now();

// TF state
const TF_CORRECT=[false,true,false]; // Q4: falskt, sant, falskt
let tfAnswered=[false,false,false];
let tfCorrectCount=0;

// MC correct answers: q0=1, q1=1, q5=1
const MC_CORRECT={0:1, 1:1, 5:1};

function getPoints(){return parseInt(localStorage.getItem(PREFIX+'points')||'0')}
function addPoints(n){const p=getPoints()+n;localStorage.setItem(PREFIX+'points',p.toString());updatePointsDisplay();totalQuizPoints+=n;return p;}
function updatePointsDisplay(){document.getElementById('pointsDisplay').textContent=getPoints()+' p';}
function getProgress(){return JSON.parse(localStorage.getItem(PREFIX+'progress')||'{}')}
function markComplete(){const p=getProgress();p[PAGE_ID]=true;localStorage.setItem(PREFIX+'progress',JSON.stringify(p));updateNav();}
function saveStats(){
  const stats=JSON.parse(localStorage.getItem(PREFIX+'pageStats')||'{}');
  stats[PAGE_ID]={time:Math.round((Date.now()-startTime)/1000),results:qResults,points:totalQuizPoints,hintsPerQ:hintsUsed,timestamp:new Date().toISOString()};
  localStorage.setItem(PREFIX+'pageStats',JSON.stringify(stats));
}

function answerMC(qIdx, choice){
  const card=document.getElementById('q'+qIdx);
  const btns=card.querySelectorAll('.option-btn');
  if(btns[0].disabled)return;

  const correct=MC_CORRECT[qIdx]===choice;
  if(correct){
    btns[choice].classList.add('correct');
    document.getElementById('fb'+qIdx+'-correct').classList.add('show');
    const pts=hintsUsed[qIdx]>0?5:10;
    addPoints(pts);
    qResults[qIdx]=true;
    qPoints[qIdx]=pts;
  } else {
    btns[choice].classList.add('wrong');
    btns[MC_CORRECT[qIdx]].classList.add('correct');
    document.getElementById('fb'+qIdx+'-wrong').classList.add('show');
    qResults[qIdx]=false;
    qPoints[qIdx]=0;
  }
  btns.forEach(b=>b.disabled=true);
  updateDot(qIdx, correct);
  document.getElementById('next'+qIdx).classList.add('show');
}

function answerFill(qIdx){
  const input=document.getElementById('fill'+qIdx);
  const val=input.value.trim().toLowerCase();
  if(!val)return;

  if(qIdx===2){
    const correct=val.includes('piga')||val.includes('pigor');
    if(correct){
      input.classList.add('correct');
      document.getElementById('fb2-correct').classList.add('show');
      const pts=hintsUsed[2]>0?5:10;
      addPoints(pts);
      qResults[2]=true;qPoints[2]=pts;
      updateDot(2,true);
    } else {
      input.classList.add('wrong');
      document.getElementById('fb2-wrong').classList.add('show');
      qResults[2]=false;qPoints[2]=0;
      updateDot(2,false);
    }
    input.disabled=true;
    document.querySelector('#q2 .fill-submit').disabled=true;
    document.getElementById('next2').classList.add('show');
  }
}

function answerTF(tfIdx, userAnswer){
  if(tfAnswered[tfIdx]) return;
  tfAnswered[tfIdx]=true;

  const group=document.getElementById('tf'+tfIdx);
  const btns=group.querySelectorAll('.tf-btn');
  const correct=userAnswer===TF_CORRECT[tfIdx];
  const explain=document.getElementById('tf'+tfIdx+'-explain');

  if(correct){
    btns[userAnswer?0:1].classList.add('correct');
    tfCorrectCount++;
    explain.textContent='R\u00e4tt!';
    explain.style.color='#166534';
  } else {
    btns[userAnswer?0:1].classList.add('wrong');
    btns[TF_CORRECT[tfIdx]?0:1].classList.add('correct');
    explain.textContent='Fel \u2013 svaret \u00e4r '+(TF_CORRECT[tfIdx]?'sant':'falskt')+'.';
    explain.style.color='#991b1b';
  }
  explain.classList.add('show');
  btns.forEach(b=>b.disabled=true);

  // Check if all three answered
  if(tfAnswered[0]&&tfAnswered[1]&&tfAnswered[2]){
    if(tfCorrectCount===3){
      document.getElementById('fb3-correct').classList.add('show');
      const pts=hintsUsed[3]>0?5:10;
      addPoints(pts);
      qResults[3]=true;qPoints[3]=pts;
      updateDot(3,true);
    } else if(tfCorrectCount>=2){
      document.getElementById('fb3-wrong').textContent='N\u00e4stan! Du fick '+tfCorrectCount+'/3 r\u00e4tt.';
      document.getElementById('fb3-wrong').classList.add('show');
      const pts=5;
      addPoints(pts);
      qResults[3]='partial';qPoints[3]=pts;
      updateDot(3,'partial');
    } else {
      document.getElementById('fb3-wrong').textContent='Du fick '+tfCorrectCount+'/3 r\u00e4tt. L\u00e4s igenom f\u00f6rklaringarna!';
      document.getElementById('fb3-wrong').classList.add('show');
      qResults[3]=false;qPoints[3]=0;
      updateDot(3,false);
    }
    document.getElementById('next3').classList.add('show');
  }
}

function updateWC4(){
  const text=document.getElementById('open4').value.trim();
  const words=text?text.split(/\s+/).length:0;
  document.getElementById('wc4').textContent=words+' ord (minst 15)';
  document.getElementById('submit4').disabled=words<15;
}

function submitOpen(qIdx){
  if(qIdx===4){
    document.getElementById('compare4').classList.add('show');
    document.getElementById('submit4').disabled=true;
    document.getElementById('open4').disabled=true;
  }
}

function selfAssessQ4(good){
  const pts=good?20:10;
  addPoints(pts);
  qResults[4]=good?true:'partial';
  qPoints[4]=pts;
  updateDot(4, good);
  document.getElementById('sa4').innerHTML='<span style="color:var(--success);font-weight:600">+'+pts+' po\u00e4ng!</span>';
  document.getElementById('next4').classList.add('show');
  // Save open answer
  const stats=JSON.parse(localStorage.getItem(PREFIX+'pageStats')||'{}');
  stats['del2-quiz-q5-answer']=document.getElementById('open4').value;
  localStorage.setItem(PREFIX+'pageStats',JSON.stringify(stats));
}

function showHint(qIdx){
  hintsUsed[qIdx]++;
  document.getElementById('hint'+qIdx).classList.add('show');
}

function nextQ(idx){
  document.getElementById('q'+(idx-1)).classList.remove('active');
  document.getElementById('q'+idx).classList.add('active');
  document.getElementById('dot'+idx).classList.add('active');
  currentQ=idx;
}

function updateDot(idx, correct){
  const dot=document.getElementById('dot'+idx);
  dot.classList.remove('active');
  if(correct===true) dot.classList.add('correct');
  else if(correct==='partial') dot.classList.add('partial');
  else dot.classList.add('wrong');
}

function showResults(){
  document.getElementById('q5').classList.remove('active');
  const box=document.getElementById('resultsBox');
  box.classList.add('show');

  const correctCount=qResults.filter(r=>r===true).length;
  const partialCount=qResults.filter(r=>r==='partial').length;

  const scoreEl=document.getElementById('scoreText');
  scoreEl.textContent=correctCount+'/6 r\u00e4tt';
  if(correctCount>=5) scoreEl.classList.add('great');
  else if(correctCount>=3) scoreEl.classList.add('good');
  else scoreEl.classList.add('ok');

  document.getElementById('scoreDetail').textContent=
    'Total po\u00e4ng denna quiz: '+totalQuizPoints+' p | Tid: '+Math.round((Date.now()-startTime)/1000)+' sekunder';

  // Encouragement
  const enc=document.getElementById('encouragement');
  if(correctCount>=5) enc.textContent='Fantastiskt, Buster! Du har koll p\u00e5 Vasatiden!';
  else if(correctCount>=3) enc.textContent='Bra jobbat, Buster! Du kan en hel del om livet p\u00e5 Vasatiden.';
  else enc.textContent='Bra f\u00f6rs\u00f6k, Buster! L\u00e4s igenom texterna igen s\u00e5 k\u00f6r vi en g\u00e5ng till.';

  const grid=document.getElementById('resultGrid');
  const labels=['Sj\u00e4lv\u00e4gande b\u00f6nder (E)','Gruvorna (C)','Piga (E)','Sant/Falskt (C)','B\u00f6ndernas uppror (A)','Gruvtrollen (A)'];
  labels.forEach((label,i)=>{
    const div=document.createElement('div');
    div.className='result-item '+(qResults[i]===true?'right':qResults[i]==='partial'?'partial':'wrong');
    div.textContent=(qResults[i]===true?'R\u00e4tt':qResults[i]==='partial'?'Delvis':'Fel')+': '+label;
    grid.appendChild(div);
  });

  markComplete();
  saveStats();
}

function updateNav(){
  const progress=getProgress();const pages=['del2-01','del2-02','del2-03','del2-04','del2-quiz'];let done=0;
  pages.forEach(p=>{const el=document.getElementById('nav-'+p);if(el&&progress[p]){el.classList.add('done');el.querySelector('.icon').innerHTML='&#10003;';done++;}});
  document.getElementById('progressText').textContent=done+'/'+pages.length;
  document.getElementById('progressBar').style.width=Math.round(done/pages.length*100)+'%';
}

function checkPrevious(){
  const progress=getProgress();
  if(progress[PAGE_ID]){
    const stats=JSON.parse(localStorage.getItem(PREFIX+'pageStats')||'{}');
    if(stats[PAGE_ID]){
      document.querySelector('.quiz-info').innerHTML='Du har redan gjort denna quiz! Resultat: '+stats[PAGE_ID].points+' po\u00e4ng. <a href="index.html">Tillbaka till \u00f6versikten</a>';
    }
  }
}

updatePointsDisplay();updateNav();checkPrevious();
</script>
</body>
</html>